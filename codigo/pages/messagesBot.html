<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cadastro de Mensagens</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/styleBot.css">
    <link rel="shortcut icon" href="../assets/images/logo.ico" type="image/x-icon">   
</head>

<body onload="ListaMensagens()">
    <h1>Listagem de Mensagens</h1>

    <div class="container">
        <div class="row">
            <div id="msg" class="col-sm-10 offset-sm-1 ">

            </div>
        </div>

        <div class="row">
            <div id="msg" class="col-sm-2 offset-sm-10 ">
                <a href="indexMessage.html"><input type="button" class="btn btn-warning" id="btnClear" value="Cadastro"></a>
            </div>
        </div>        
        
        <form id="form-mensagem">            
            <div class="form-group row">
                <div class="col-sm-4">
                    <input type="date" name="filtro_data" id="filtro_data" oninput="ListaMensagens()" class="form-control" placeholder="Digite a Data">
                </div>
                <div class="col-sm-8">
                    <input type="text" name="filtro_categoria" id="filtro_categoria" oninput="ListaMensagens()" class="form-control" placeholder="Digite a Categoria">
                </div>
            </div>
        </form>

        <div class="row">
            <div class="col-sm-12">
                <table id="grid-mensagens" class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Opção</th>
                            <th scope="col">Categoria</th>
                            <th scope="col">Tipo</th>
                            <th scope="col">Data</th>
                            <th scope="col">Conteúdo</th>
                        </tr>
                    </thead>
                    <tbody id="table-mensagens">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="../assets/js/mainmessage.js"></script>
    <script>
        var db_mensagens_inicial = {
            "data": [
                { "id": 1, "opcao": "Ataque DDoS", "categoria": "informativa", "tipo": "Informativa", "data": "2023-06-01", "conteudo": "Ataque DDoS detectado em nosso servidor principal. Um ataque DDoS (Distributed Denial of Service) visa sobrecarregar um servidor com tráfego para torná-lo indisponível." },
                { "id": 2, "opcao": "Injeção SQL", "categoria": "informativa", "tipo": "Informativa", "data": "2023-06-02", "conteudo": "Tentativa de injeção SQL bloqueada no sistema de login. Injeção SQL é uma técnica de ataque onde comandos SQL são inseridos em campos de entrada para manipular o banco de dados." },
                { "id": 3, "opcao": "Phishing", "categoria": "informativa", "tipo": "Informativa", "data": "2023-06-03", "conteudo": "Email de phishing detectado e removido. Phishing é uma tentativa de obter informações sensíveis enganando as pessoas para que divulguem dados pessoais." },
                { "id": 4, "opcao": "Malware", "categoria": "informativa", "tipo": "Informativa", "data": "2023-06-04", "conteudo": "Malware encontrado em um dispositivo da rede interna. Malware é um software malicioso projetado para danificar, interromper ou ganhar acesso não autorizado a sistemas de computador." },
                { "id": 5, "opcao": "Ransomware", "categoria": "informativa", "tipo": "Informativa", "data": "2023-06-05", "conteudo": "Ataque de ransomware detectado e contido. Ransomware é um tipo de malware que criptografa os dados da vítima e exige um resgate para restaurar o acesso." }
            ]
        };

        var db = JSON.parse(localStorage.getItem('db_mensagens'));
        if (!db) {
            db = db_mensagens_inicial;
        }

        function displayMessage(msg) {
            $('#msg').html('<div class="alert alert-warning">' + msg + '</div>');
        }

        function ListaMensagens() {
            let fd = $("#filtro_data").val();
            let fcg = $("#filtro_categoria").val().toLowerCase(); 

            $("#table-mensagens").empty();

            for (let index = 0; index < db.data.length; index++) {
                const mensagem = db.data[index];

                if (((mensagem.data === fd) || (fd === '')) &&
                    ((mensagem.categoria.toLowerCase().includes(fcg)) || (fcg === ''))) {
                       
                    $("#table-mensagens").append(`<tr><td scope="row">${mensagem.id}</td>
                                                    <td>${mensagem.opcao}</td>
                                                    <td>${mensagem.categoria}</td>
                                                    <td>${mensagem.tipo}</td>
                                                    <td>${mensagem.data}</td>
                                                    <td>${mensagem.conteudo}</td>
                                                </tr>`);
                }
            }
        }
    </script>
</body>
</html>
